{% extends "base.html" %}

{% block title %}Edit {{ character.name }} - D&D Character Manager{% endblock %}

{% block extra_css %}
<style>
    .form-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .form-title {
        color: #2c3e50;
        margin-top: 0;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #3498db;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #2c3e50;
    }
    
    .form-control {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
        transition: border-color 0.2s;
    }
    
    .form-control:focus {
        border-color: #3498db;
        outline: none;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }
    
    textarea.form-control {
        min-height: 120px;
        resize: vertical;
    }
    
    .form-actions {
        display: flex;
        justify-content: space-between;
        gap: 1rem;
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid #eee;
    }
    
    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 4px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-block;
        text-align: center;
    }
    
    .btn-primary {
        background: #3498db;
        color: white;
    }
    
    .btn-primary:hover {
        background: #2980b9;
    }
    
    .btn-secondary {
        background: #95a5a6;
        color: white;
    }
    
    .btn-secondary:hover {
        background: #7f8c8d;
    }
    
    .btn-danger {
        background: #e74c3c;
        color: white;
    }
    
    .btn-danger:hover {
        background: #c0392b;
    }
    
    .form-row {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }
    
    .form-col {
        flex: 1;
        min-width: 200px;
    }
    
    .error-message {
        color: #e74c3c;
        margin-top: 0.5rem;
        font-size: 0.9em;
    }
    
    .image-preview-container {
        margin-top: 1rem;
    }
    
    .current-image {
        max-width: 200px;
        border-radius: 4px;
        border: 1px solid #ddd;
        margin-bottom: 1rem;
    }
    
    .image-preview {
        max-width: 200px;
        margin-top: 1rem;
        display: none;
        border-radius: 4px;
        border: 1px solid #ddd;
    }
    
    @media (max-width: 768px) {
        .form-container {
            padding: 1rem;
        }
        
        .form-row {
            flex-direction: column;
            gap: 0;
        }
        
        .form-col {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <h1 class="form-title">Edit Character: {{ character.name }}</h1>
    
    {% if error %}
    <div class="error-message" style="margin-bottom: 1.5rem;">
        {{ error }}
    </div>
    {% endif %}
    
    <form method="POST" enctype="multipart/form-data">
        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label for="character-name" class="form-label">Character Name *</label>
                    <input type="text" id="character-name" name="character-name" class="form-control" 
                           value="{{ character.name }}" required>
                </div>
                
                <div class="form-group">
                    <label for="race" class="form-label">Race *</label>
                    <input type="text" id="race" name="race" class="form-control" 
                           value="{{ character.race }}" required>
                </div>
                
                <div class="form-group">
                    <label for="character-class" class="form-label">Class *</label>
                    <input type="text" id="character-class" name="character-class" class="form-control" 
                           value="{{ character.character_class }}" required>
                </div>
                
                <div class="form-group">
                    <label for="level" class="form-label">Level *</label>
                    <input type="number" id="level" name="level" class="form-control" min="1" max="20" 
                           value="{{ character.level }}" required>
                </div>
            </div>
            
            <div class="form-col">
                <div class="form-group">
                    <label for="alignment" class="form-label">Alignment</label>
                    <select id="alignment" name="alignment" class="form-control">
                        <option value="" {% if not character.alignment %}selected{% endif %}>Select Alignment</option>
                        <option value="Lawful Good" {% if character.alignment == 'Lawful Good' %}selected{% endif %}>Lawful Good</option>
                        <option value="Neutral Good" {% if character.alignment == 'Neutral Good' %}selected{% endif %}>Neutral Good</option>
                        <option value="Chaotic Good" {% if character.alignment == 'Chaotic Good' %}selected{% endif %}>Chaotic Good</option>
                        <option value="Lawful Neutral" {% if character.alignment == 'Lawful Neutral' %}selected{% endif %}>Lawful Neutral</option>
                        <option value="True Neutral" {% if character.alignment == 'True Neutral' %}selected{% endif %}>True Neutral</option>
                        <option value="Chaotic Neutral" {% if character.alignment == 'Chaotic Neutral' %}selected{% endif %}>Chaotic Neutral</option>
                        <option value="Lawful Evil" {% if character.alignment == 'Lawful Evil' %}selected{% endif %}>Lawful Evil</option>
                        <option value="Neutral Evil" {% if character.alignment == 'Neutral Evil' %}selected{% endif %}>Neutral Evil</option>
                        <option value="Chaotic Evil" {% if character.alignment == 'Chaotic Evil' %}selected{% endif %}>Chaotic Evil</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="background" class="form-label">Background</label>
                    <input type="text" id="background" name="background" class="form-control" 
                           value="{{ character.background or '' }}">
                </div>
                
                <div class="form-group">
                    <label for="image-upload" class="form-label">Character Image</label>
                    <div class="image-preview-container">
                        {% if character.image_path %}
                        <div>
                            <p>Current Image:</p>
                            <img src="{{ url_for('static', filename=character.image_path) }}" 
                                 alt="{{ character.image_alt }}" 
                                 class="current-image">
                        </div>
                        {% endif %}
                        <input type="file" id="image-upload" name="image-upload" class="form-control" accept="image/*">
                        <img id="image-preview" class="image-preview" src="" alt="Preview">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="short-description" class="form-label">Short Description *</label>
            <textarea id="short-description" name="short-description" class="form-control" required>{{ character.short_description }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="backstory" class="form-label">Backstory</label>
            <textarea id="backstory" name="backstory" class="form-control">{{ character.backstory or '' }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="personality" class="form-label">Personality & Traits</label>
            <textarea id="personality" name="personality" class="form-control">{{ character.personality or '' }}</textarea>
            <small class="form-text text-muted">Describe the character's personality, ideals, bonds, and flaws.</small>
        </div>
        
        <div class="form-group">
            <label for="abilities-skills" class="form-label">Abilities & Skills</label>
            <textarea id="abilities-skills" name="abilities-skills" class="form-control">{{ character.abilities_skills or '' }}</textarea>
            <small class="form-text text-muted">List the character's abilities, skills, and special features.</small>
        </div>
        
        <div class="form-actions">
            <div>
                <a href="{{ url_for('character_detail', character_id=character.id) }}" class="btn btn-secondary">Cancel</a>
            </div>
            <div>
                <a href="{{ url_for('delete_character', character_id=character.id) }}" 
                   class="btn btn-danger" 
                   onclick="return confirm('Are you sure you want to delete this character? This cannot be undone.');">
                    Delete Character
                </a>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </div>
    </form>
</div>

<script>
    // Image preview functionality
    document.getElementById('image-upload').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            const preview = document.getElementById('image-preview');
            
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                
                // Hide the current image when a new one is selected
                const currentImage = document.querySelector('.current-image');
                if (currentImage) {
                    currentImage.style.display = 'none';
                }
            }
            
            reader.readAsDataURL(file);
        }
    });
</script>
{% endblock %}
